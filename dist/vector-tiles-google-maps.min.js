function VectorTile(n,t){var r,u,f,i;for(this.layers={},this._buffer=n,t=t||n.length,r=n.pos;r<t;)u=n.readVarint(),f=u>>3,f===3?(i=this._readLayer(),i.length&&(this.layers[i.name]=i)):n.skip(u),r=n.pos;this.parseGeometries()}function VectorTileFeature(n,t,i,r,u){var f,e,o,s,h,c;for(this.properties={},this.extent=i,this.type=0,this._buffer=n,this._geometry=-1,t=t||n.length,f=n.pos;f<t;){n.pos=f;e=n.readVarint();o=e>>3;f=n.pos;switch(o){case 1:this._id=n.readVarint();f=n.pos;break;case 2:for(s=f+n.readVarint(),f=n.pos;f<s;)n.pos=f,h=n.readVarint(),c=n.readVarint(),this.properties[r[h]]=u[c],f=n.pos;break;case 3:this.type=n.readVarint();f=n.pos;break;case 4:this._geometry=f;n.skip(e);f=n.pos;break;default:n.skip(e);f=n.pos}}n.pos=f}function VectorTileLayer(n,t){this.version=1;this.name=null;this.extent=4096;this.length=0;this._buffer=n;this._keys=[];this._values=[];this._features=[];t=t||n.length;for(var i,r;n.pos<t;){i=n.readVarint();r=i>>3;switch(r){case 15:this.version=n.readVarint();break;case 1:this.name=n.readString();break;case 5:this.extent=n.readVarint();break;case 2:this.length++;this._features.push(n.pos);n.skip(i);break;case 3:this._keys.push(n.readString());break;case 4:this._values.push(this.readFeatureValue());break;default:n.skip(i)}}}function Point(n,t){this.x=n;this.y=t}!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this;t.Pbf=n()}}(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof require&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof require&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){"use strict";function i(n){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(n)?n:new Uint8Array(n||0);this.pos=0;this.type=0;this.length=this.buf.length}function a(n,t,i){var f,r,e=i.buf;if((r=e[i.pos++],f=(112&r)>>4,r<128)||(r=e[i.pos++],f|=(127&r)<<3,r<128)||(r=e[i.pos++],f|=(127&r)<<10,r<128)||(r=e[i.pos++],f|=(127&r)<<17,r<128)||(r=e[i.pos++],f|=(127&r)<<24,r<128)||(r=e[i.pos++],f|=(1&r)<<31,r<128))return u(n,f,t);throw new Error("Expected varint not more than 10 bytes");}function r(n){return n.type===i.Bytes?n.readVarint()+n.pos:n.pos+1}function u(n,t,i){return i?4294967296*t+(n>>>0):4294967296*(t>>>0)+(n>>>0)}function v(n,t){var i,r;if(n>=0?(i=n%4294967296|0,r=n/4294967296|0):(i=~(-n%4294967296),r=~(-n/4294967296),4294967295^i?i=i+1|0:(i=0,r=r+1|0)),n>=0x10000000000000000||n<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10);y(i,r,t);p(r,t)}function y(n,t,i){i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos++]=127&n|128;n>>>=7;i.buf[i.pos]=127&n}function p(n,t){var i=(7&n)<<4;t.buf[t.pos++]|=i|((n>>>=3)?128:0);n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n|((n>>>=7)?128:0),n&&(t.buf[t.pos++]=127&n)))))}function c(n,t,i){var u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.ceil(Math.log(t)/(7*Math.LN2)),r;for(i.realloc(u),r=i.pos-1;r>=n;r--)i.buf[r+u]=i.buf[r]}function w(n,t){for(var i=0;i<n.length;i++)t.writeVarint(n[i])}function b(n,t){for(var i=0;i<n.length;i++)t.writeSVarint(n[i])}function k(n,t){for(var i=0;i<n.length;i++)t.writeFloat(n[i])}function d(n,t){for(var i=0;i<n.length;i++)t.writeDouble(n[i])}function g(n,t){for(var i=0;i<n.length;i++)t.writeBoolean(n[i])}function nt(n,t){for(var i=0;i<n.length;i++)t.writeFixed32(n[i])}function tt(n,t){for(var i=0;i<n.length;i++)t.writeSFixed32(n[i])}function it(n,t){for(var i=0;i<n.length;i++)t.writeFixed64(n[i])}function rt(n,t){for(var i=0;i<n.length;i++)t.writeSFixed64(n[i])}function o(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+16777216*n[t+3]}function f(n,t,i){n[i]=t;n[i+1]=t>>>8;n[i+2]=t>>>16;n[i+3]=t>>>24}function l(n,t){return(n[t]|n[t+1]<<8|n[t+2]<<16)+(n[t+3]<<24)}function ut(n,t,i){for(var f,s,c,h="",u=t;u<i;){var e=n[u],r=null,o=e>239?4:e>223?3:e>191?2:1;if(u+o>i)break;1===o?e<128&&(r=e):2===o?(f=n[u+1],128==(192&f)&&(r=(31&e)<<6|63&f,r<=127&&(r=null))):3===o?(f=n[u+1],s=n[u+2],128==(192&f)&&128==(192&s)&&(r=(15&e)<<12|(63&f)<<6|63&s,(r<=2047||r>=55296&&r<=57343)&&(r=null))):4===o&&(f=n[u+1],s=n[u+2],c=n[u+3],128==(192&f)&&128==(192&s)&&128==(192&c)&&(r=(15&e)<<18|(63&f)<<12|(63&s)<<6|63&c,(r<=65535||r>=1114112)&&(r=null)));null===r?(r=65533,o=1):r>65535&&(r-=65536,h+=String.fromCharCode(r>>>10&1023|55296),r=56320|1023&r);h+=String.fromCharCode(r);u+=o}return h}function ft(n,t,i){for(var r,u,f=0;f<t.length;f++){if(r=t.charCodeAt(f),r>55295&&r<57344){if(!u){r>56319||f+1===t.length?(n[i++]=239,n[i++]=191,n[i++]=189):u=r;continue}if(r<56320){n[i++]=239;n[i++]=191;n[i++]=189;u=r;continue}r=u-55296<<10|r-56320|65536;u=null}else u&&(n[i++]=239,n[i++]=191,n[i++]=189,u=null);r<128?n[i++]=r:(r<2048?n[i++]=r>>6|192:(r<65536?n[i++]=r>>12|224:(n[i++]=r>>18|240,n[i++]=r>>12&63|128),n[i++]=r>>6&63|128),n[i++]=63&r|128)}return i}var e,s,h;t.exports=i;e=n("ieee754");i.Varint=0;i.Fixed64=1;i.Bytes=2;i.Fixed32=5;s=4294967296;h=1/s;i.prototype={destroy:function(){this.buf=null},readFields:function(n,t,i){for(i=i||this.length;this.pos<i;){var r=this.readVarint(),u=r>>3,f=this.pos;this.type=7&r;n(u,t,this);this.pos===f&&this.skip(r)}return t},readMessage:function(n,t){return this.readFields(n,t,this.readVarint()+this.pos)},readFixed32:function(){var n=o(this.buf,this.pos);return this.pos+=4,n},readSFixed32:function(){var n=l(this.buf,this.pos);return this.pos+=4,n},readFixed64:function(){var n=o(this.buf,this.pos)+o(this.buf,this.pos+4)*s;return this.pos+=8,n},readSFixed64:function(){var n=o(this.buf,this.pos)+l(this.buf,this.pos+4)*s;return this.pos+=8,n},readFloat:function(){var n=e.read(this.buf,this.pos,!0,23,4);return this.pos+=4,n},readDouble:function(){var n=e.read(this.buf,this.pos,!0,52,8);return this.pos+=8,n},readVarint:function(n){var i,t,r=this.buf;return t=r[this.pos++],i=127&t,t<128?i:(t=r[this.pos++],i|=(127&t)<<7,t<128?i:(t=r[this.pos++],i|=(127&t)<<14,t<128?i:(t=r[this.pos++],i|=(127&t)<<21,t<128?i:(t=r[this.pos],i|=(15&t)<<28,a(i,n,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var n=this.readVarint();return n%2==1?(n+1)/-2:n/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var n=this.readVarint()+this.pos,t=ut(this.buf,this.pos,n);return this.pos=n,t},readBytes:function(){var n=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,n);return this.pos=n,t},readPackedVarint:function(n,t){var i=r(this);for(n=n||[];this.pos<i;)n.push(this.readVarint(t));return n},readPackedSVarint:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readSVarint());return n},readPackedBoolean:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readBoolean());return n},readPackedFloat:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readFloat());return n},readPackedDouble:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readDouble());return n},readPackedFixed32:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readFixed32());return n},readPackedSFixed32:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed32());return n},readPackedFixed64:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readFixed64());return n},readPackedSFixed64:function(n){var t=r(this);for(n=n||[];this.pos<t;)n.push(this.readSFixed64());return n},skip:function(n){var t=7&n;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(n,t){this.writeVarint(n<<3|t)},realloc:function(n){for(var i,t=this.length||16;t<this.pos+n;)t*=2;t!==this.length&&(i=new Uint8Array(t),i.set(this.buf),this.buf=i,this.length=t)},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(n){this.realloc(4);f(this.buf,n,this.pos);this.pos+=4},writeSFixed32:function(n){this.realloc(4);f(this.buf,n,this.pos);this.pos+=4},writeFixed64:function(n){this.realloc(8);f(this.buf,n&-1,this.pos);f(this.buf,Math.floor(n*h),this.pos+4);this.pos+=8},writeSFixed64:function(n){this.realloc(8);f(this.buf,n&-1,this.pos);f(this.buf,Math.floor(n*h),this.pos+4);this.pos+=8},writeVarint:function(n){return n=+n||0,n>268435455||n<0?void v(n,this):(this.realloc(4),this.buf[this.pos++]=127&n|(n>127?128:0),void(n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=127&(n>>>=7)|(n>127?128:0),n<=127||(this.buf[this.pos++]=n>>>7&127)))))},writeSVarint:function(n){this.writeVarint(n<0?2*-n-1:2*n)},writeBoolean:function(n){this.writeVarint(Boolean(n))},writeString:function(n){var i,t;n=String(n);this.realloc(4*n.length);this.pos++;i=this.pos;this.pos=ft(this.buf,n,this.pos);t=this.pos-i;t>=128&&c(i,t,this);this.pos=i-1;this.writeVarint(t);this.pos+=t},writeFloat:function(n){this.realloc(4);e.write(this.buf,n,this.pos,!0,23,4);this.pos+=4},writeDouble:function(n){this.realloc(8);e.write(this.buf,n,this.pos,!0,52,8);this.pos+=8},writeBytes:function(n){var i=n.length,t;for(this.writeVarint(i),this.realloc(i),t=0;t<i;t++)this.buf[this.pos++]=n[t]},writeRawMessage:function(n,t){var r,i;this.pos++;r=this.pos;n(t,this);i=this.pos-r;i>=128&&c(r,i,this);this.pos=r-1;this.writeVarint(i);this.pos+=i},writeMessage:function(n,t,r){this.writeTag(n,i.Bytes);this.writeRawMessage(t,r)},writePackedVarint:function(n,t){this.writeMessage(n,w,t)},writePackedSVarint:function(n,t){this.writeMessage(n,b,t)},writePackedBoolean:function(n,t){this.writeMessage(n,g,t)},writePackedFloat:function(n,t){this.writeMessage(n,k,t)},writePackedDouble:function(n,t){this.writeMessage(n,d,t)},writePackedFixed32:function(n,t){this.writeMessage(n,nt,t)},writePackedSFixed32:function(n,t){this.writeMessage(n,tt,t)},writePackedFixed64:function(n,t){this.writeMessage(n,it,t)},writePackedSFixed64:function(n,t){this.writeMessage(n,rt,t)},writeBytesField:function(n,t){this.writeTag(n,i.Bytes);this.writeBytes(t)},writeFixed32Field:function(n,t){this.writeTag(n,i.Fixed32);this.writeFixed32(t)},writeSFixed32Field:function(n,t){this.writeTag(n,i.Fixed32);this.writeSFixed32(t)},writeFixed64Field:function(n,t){this.writeTag(n,i.Fixed64);this.writeFixed64(t)},writeSFixed64Field:function(n,t){this.writeTag(n,i.Fixed64);this.writeSFixed64(t)},writeVarintField:function(n,t){this.writeTag(n,i.Varint);this.writeVarint(t)},writeSVarintField:function(n,t){this.writeTag(n,i.Varint);this.writeSVarint(t)},writeStringField:function(n,t){this.writeTag(n,i.Bytes);this.writeString(t)},writeFloatField:function(n,t){this.writeTag(n,i.Fixed32);this.writeFloat(t)},writeDoubleField:function(n,t){this.writeTag(n,i.Fixed64);this.writeDouble(t)},writeBooleanField:function(n,t){this.writeVarintField(n,Boolean(t))}}},{ieee754:2}],2:[function(n,t,i){i.read=function(n,t,i,r,u){var f,o,l=8*u-r-1,a=(1<<l)-1,v=a>>1,e=-7,s=i?u-1:0,c=i?-1:1,h=n[t+s];for(s+=c,f=h&(1<<-e)-1,h>>=-e,e+=l;e>0;f=256*f+n[t+s],s+=c,e-=8);for(o=f&(1<<-e)-1,f>>=-e,e+=r;e>0;o=256*o+n[t+s],s+=c,e-=8);if(0===f)f=1-v;else{if(f===a)return o?NaN:(h?-1:1)*(1/0);o+=Math.pow(2,r);f-=v}return(h?-1:1)*o*Math.pow(2,f-r)};i.write=function(n,t,i,r,u,f){var e,o,s,l=8*f-u-1,a=(1<<l)-1,h=a>>1,y=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,c=r?0:f-1,v=r?1:-1,p=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,e=a):(e=Math.floor(Math.log(t)/Math.LN2),t*(s=Math.pow(2,-e))<1&&(e--,s*=2),t+=e+h>=1?y/s:y*Math.pow(2,1-h),t*s>=2&&(e++,s/=2),e+h>=a?(o=0,e=a):e+h>=1?(o=(t*s-1)*Math.pow(2,u),e+=h):(o=t*Math.pow(2,h-1)*Math.pow(2,u),e=0));u>=8;n[i+c]=255&o,c+=v,o/=256,u-=8);for(e=e<<u|o,l+=u;l>0;n[i+c]=255&e,c+=v,e/=256,l-=8);n[i+c-v]|=128*p}},{}]},{},[1])(1)});VectorTile.prototype._readLayer=function(){var n=this._buffer,i=n.readVarint(),t=n.pos+i,r=new VectorTileLayer(n,t);return n.pos=t,r};VectorTile.prototype.parseGeometries=function(){var i=this.layers,r,n,t;for(r in i)if(i.hasOwnProperty(r)){var u=i[r],o=u._features,f=o.length,e=new Array(f);for(n=0;n<f;n++)t=u.feature(n),t.coordinates=t.loadGeometry(),e[n]=t;u.parsedFeatures=e}};VectorTileFeature.types=["Unknown","Point","LineString","Polygon"];VectorTileFeature.prototype.loadGeometry=function(){var n=this._buffer,e;n.pos=this._geometry;for(var h=n.pos+n.readVarint(),i=1,u=0,o=0,s=0,f=[],t=null,r=n.pos;r<h;)if(u===0&&(n.pos=r,e=n.readVarint(),i=e&7,u=e>>3,r=n.pos),u--,i===1||i===2)n.pos=r,o+=n.readSVarint(),s+=n.readSVarint(),r=n.pos,i===1&&(t!==null&&f.push(t),t=[]),t.push(new Point(o,s));else if(i===7)t!==null&&t.length>0&&t.push(t[0].clone());else throw new Error("unknown command "+i);return t!==null&&f.push(t),f};VectorTileFeature.prototype.bbox=function(){var n=this._buffer,c;n.pos=this._geometry;for(var l=n.pos+n.readVarint(),t=1,f=0,i=0,r=0,e=Infinity,o=-Infinity,s=Infinity,h=-Infinity,u=n.pos;u<l;)if(f===0&&(n.pos=u,c=n.readVarint(),t=c&7,f=c>>3,u=n.pos),f--,t===1||t===2)n.pos=u,i+=n.readSVarint(),r+=n.readSVarint(),u=n.pos,i<e&&(e=i),i>o&&(o=i),r<s&&(s=r),r>h&&(h=r);else if(t!==7)throw new Error("unknown command "+t);return[e,s,o,h]};VectorTileLayer.prototype.readFeatureValue=function(){for(var n=this._buffer,t=null,u=n.pos+n.readVarint(),i,r;n.pos<u;){i=n.readVarint();r=i>>3;switch(r){case 1:t=n.readString();break;case 2:t=n.readFloat();break;case 3:t=n.readDouble();break;case 4:case 5:t=n.readVarint();break;case 6:t=n.readSVarint();break;case 7:t=Boolean(n.readVarint());break;default:n.skip(i)}}return t};VectorTileLayer.prototype.feature=function(n){if(n<0||n>=this._features.length)throw new Error("feature index out of bounds");this._buffer.pos=this._features[n];var t=this._buffer.readVarint()+this._buffer.pos;return new VectorTileFeature(this._buffer,t,this.extent,this._keys,this._values)};Point.prototype.clone=function(){return new Point(this.x,this.y)};Point.prototype.add=function(n){return new Point(this.x+n.x,this.y+n.y)};Point.prototype.sub=function(n){return new Point(this.x-n.x,this.y-n.y)};Point.prototype.mult=function(n){return new Point(this.x*n,this.y*n)};Point.prototype.div=function(n){return new Point(this.x/n,this.y/n)};Point.prototype.rotate=function(n){const t=Math.cos(n),i=Math.sin(n);return new Point(t*this.x-i*this.y,i*this.x+t*this.y)};Point.prototype.matMult=function(n){return new Point(n[0]*this.x+n[1]*this.y,n[2]*this.x+n[3]*this.y)};Point.prototype.unit=function(){const n=Math.sqrt(this.x*this.x+this.y*this.y);return new Point(this.x/n,this.y/n)};Point.prototype.perp=function(){return new Point(-this.y,this.x)};Point.prototype.round=function(){return new Point(Math.round(this.x),Math.round(this.y))};Point.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};Point.prototype.equals=function(n){return this.x===n.x&&this.y===n.y};Point.prototype.dist=function(n){const t=n.x-this.x,i=n.y-this.y;return Math.sqrt(t*t+i*i)};Point.prototype.distSqr=function(n){const t=n.x-this.x,i=n.y-this.y;return t*t+i*i};Point.prototype.angle=function(){return Math.atan2(this.y,this.x)};Point.prototype.angleTo=function(n){return Math.atan2(this.y-n.y,this.x-n.x)};Point.prototype.angleWith=function(n){return Math.atan2(this.x*n.y-this.y*n.x,this.x*n.x+this.y*n.y)};Point.prototype.angleWithSep=function(n,t){return Math.atan2(this.x*t-this.y*n,this.x*n+this.y*t)};Point.prototype._matMult=function(n){const t=n[0]*this.x+n[1]*this.y;return this.y=n[2]*this.x+n[3]*this.y,this.x=t,this};Point.prototype._add=function(n){return this.x+=n.x,this.y+=n.y,this};Point.prototype._sub=function(n){return this.x-=n.x,this.y-=n.y,this};Point.prototype._mult=function(n){return this.x*=n,this.y*=n,this};Point.prototype._div=function(n){return this.x/=n,this.y/=n,this};Point.prototype._unit=function(){const n=Math.sqrt(this.x*this.x+this.y*this.y);return this.x/=n,this.y/=n,this};Point.prototype._perp=function(){const n=this.y;return this.y=this.x,this.x=-n,this};Point.prototype._rotate=function(n){const t=Math.cos(n),i=Math.sin(n),r=t*this.x-i*this.y;return this.y=i*this.x+t*this.y,this.x=r,this};Point.prototype._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this};Point.convert=function(n){return n instanceof Point?n:Array.isArray(n)?new Point(n[0],n[1]):n};MERCATOR=function(){const f=Math.PI/180,e=180/Math.PI,t=256/360,i=128/Math.PI,r=256,n=128,u=.9999;return{fromLatLngToPoint:function(r){const o=r.lat()*f,e=Math.min(Math.max(Math.sin(o),-u),u);return{x:n+r.lng()*t,y:n+.5*Math.log((1+e)/(1-e))*-i}},fromPointToLatLng:function(r){return{lat:(2*Math.atan(Math.exp((r.y-n)/-i))-Math.PI/2)*e,lng:(r.x-n)/t}},getTileAtLatLng:function(n,t){const f=1<<t,i=r/f,u=this.fromLatLngToPoint(n);return{x:Math.floor(u.x/i),y:Math.floor(u.y/i),z:t}},getTileBounds:function(n){n=this.normalizeTile(n);const f=1<<n.z,t=r/f,i=n.x*t,u=n.y*t;return{sw:this.fromPointToLatLng({x:i,y:u+t}),ne:this.fromPointToLatLng({x:i+t,y:u})}},normalizeTile:function(n){const t=1<<n.z;return n.x=(n.x%t+t)%t,n.y=(n.y%t+t)%t,n},fromLatLngToPixels:function(n,t){const r=n.getBounds(),i=n.getProjection(),u=1<<n.getZoom(),e=i.fromLatLngToPoint(r.getNorthEast()),o=i.fromLatLngToPoint(r.getSouthWest()),f=i.fromLatLngToPoint(t);return{x:(f.x-o.x)*u,y:(f.y-e.y)*u}},fromLatLngToTilePoint:function(n,t){const r=n.getZoom(),u=this.getTileAtLatLng(t.latLng,r),i=this.getTileBounds(u),f=new google.maps.LatLng(i.sw),e=new google.maps.LatLng(i.ne),o=this.fromLatLngToPixels(n,f),s=this.fromLatLngToPixels(n,e);return{x:t.pixel.x-o.x,y:t.pixel.y-s.y}},isPointInPolygon:function(n,t){if(!t||!t.length)return!1;let i=!1;const u=n.x,r=n.y;for(let n=0,f=t.length-1;n<t.length;f=n++){const o=t[n].x,e=t[n].y,h=t[f].x,s=t[f].y,c=e>r!=s>r&&u<(h-o)*(r-e)/(s-e)+o;c&&(i=!i)}return i},in_circle:function(n,t,i,r,u){const f=n-r,e=t-u;return f*f+e*e<=i*i},getDistanceFromLine:function(n,t){if(!t||t.length<2)return Number.POSITIVE_INFINITY;let i=Number.POSITIVE_INFINITY;const r=n.x,u=n.y;for(let n=0,f=t.length-1;n<f;n++){const f=this.projectPointOnLineSegment(r,u,t[n],t[n+1]);f<i&&(i=f)}return i},projectPointOnLineSegment:function(n,t,i,r){const u=i.x,f=i.y,c=r.x,l=r.y,p=n-u,w=t-f,s=c-u,h=l-f,b=p*s+w*h,a=s*s+h*h;let e,o;if(a===0)e=u,o=f;else{const n=b/a;n<0?(e=u,o=f):n>1?(e=c,o=l):(e=u+n*s,o=f+n*h)}const v=n-e,y=t-o;return Math.sqrt(v*v+y*y)}}}();const TWO_PI=Math.PI*2;class MVTFeature{constructor(n){this.mVTSource=n.mVTSource;this.selected=n.selected;this.featureId=n.featureId;this.tiles=Object.create(null);this.style=n.style;this.type=n.vectorTileFeature.type;this.properties=n.vectorTileFeature.properties;this.addTileFeature(n.vectorTileFeature,n.tileContext);this._draw=n.customDraw||this.defaultDraw;this.selected&&this.select()}addTileFeature(n,t){this.tiles[t.id]={vectorTileFeature:n,divisor:n.extent/t.tileSize,context2d:!1,paths2d:!1}}getTiles(){return this.tiles}getTile(n){return this.tiles[n.id]}setStyle(n){this.style=n}redrawTiles(){const i=this.mVTSource.map.getZoom(),n=this.mVTSource,r=this.tiles,t=Object.keys(r);for(let r=0,u=t.length;r<u;r++){const u=t[r];n.deleteTileDrawn(u);const f=n.getTileObject(u);f.zoom===i&&n.redrawTile(u)}}toggle(){this.selected?this.deselect():this.select()}select(){this.selected=!0;this.mVTSource.featureSelected(this);this.redrawTiles()}deselect(){this.selected=!1;this.mVTSource.featureDeselected(this);this.redrawTiles()}setSelected(n){this.selected=n}draw(n){const t=this.tiles[n.id],i=this.selected&&this.style.selected?this.style.selected:this.style;this._draw(n,t,i,this)}defaultDraw(n,t,i){const r=this.type;r===1?this.drawPoint(n,t,i):r===2?this.drawLineString(n,t,i):r===3&&this.drawPolygon(n,t,i)}drawPoint(n,t,i){const f=t.vectorTileFeature.coordinates[0][0],u=this.getPoint(f,n,t.divisor),e=i.radius||3,r=this.getContext2d(n.canvas,i);r.beginPath();r.arc(u.x,u.y,e,0,TWO_PI);r.closePath();r.fill();r.stroke()}drawLineString(n,t,i){t.context2d=this.getContext2d(n.canvas,i);this.drawCoordinates(n,t);t.context2d.stroke(t.paths2d)}drawPolygon(n,t,i){const r=this.getContext2d(n.canvas,i);t.context2d=r;this.drawCoordinates(n,t);const u=t.paths2d;u.closePath();const f=i.fillStyle,e=i.strokeStyle;f&&e?(r.fill(u),r.stroke(u)):f?r.fill(u):e&&r.stroke(u)}drawCoordinates(n,t){const i=t.vectorTileFeature.coordinates,r=t.divisor,u=new Path2D,f=i.length;for(let t=0;t<f;t++){const f=i[t],e=f.length;if(e>0){const t=new Path2D,i=this.getPoint(f[0],n,r);t.moveTo(i.x,i.y);for(let i=1;i<e;i++){const u=this.getPoint(f[i],n,r);t.lineTo(u.x,u.y)}u.addPath(t)}}t.paths2d=u}getPaths(n){const i=this.tiles[n.id],r=i.vectorTileFeature.coordinates,e=i.divisor,u=r.length,t=new Array(u);let f=0;for(let i=0;i<u;i++){const o=r[i],u=o.length,s=new Array(u);for(let t=0;t<u;t++)s[t]=this.getPoint(o[t],n,e);u>0&&(t[f++]=s)}return t.length=f,t}getContext2d(n,t){const i=n.getContext("2d"),r=Object.keys(t);for(let n=0,u=r.length;n<u;n++){const u=r[n];u!=="selected"&&(i[u]=t[u])}return i}getPoint(n,t,i){let r=n.x/i,u=n.y/i;const f=t.parentId;if(f){const e=this.mVTSource,s=e.getTileObject(f),i=e.getTileObject(t.id),h=i.zoom-s.zoom,n=Math.pow(2,h),o=t.tileSize;r=r*n-i.x%n*o;u=u*n-i.y%n*o}return{x:r,y:u}}_getOverzoomedPoint(n,t){const u=this.mVTSource,e=u.getTileObject(t.parentId),r=u.getTileObject(t.id),o=r.zoom-e.zoom,i=Math.pow(2,o),f=t.tileSize;return n.x=n.x*i-r.x%i*f,n.y=n.y*i-r.y%i*f,n}isPointInPath(n,t){const i=this.getTile(t),r=i.context2d,u=i.paths2d;return!r||!u?!1:r.isPointInPath(u,n.x,n.y)}}class MVTLayer{constructor(n){this._lineClickTolerance=2;this._getIDForLayerFeature=n.getIDForLayerFeature;this.style=n.style;this.name=n.name;this._filter=n.filter||!1;this._customDraw=n.customDraw||!1;this._canvasAndMVTFeatures=Object.create(null);this._mVTFeatures=Object.create(null)}parseVectorTileFeatures(n,t,i){const u=i.id,r=[];this._canvasAndMVTFeatures[u]={canvas:i.canvas,features:r};for(let u=0,f=t.length;u<f;u++){const f=this._parseVectorTileFeature(n,t[u],i,u);f&&r.push(f)}this.drawTile(i)}_parseVectorTileFeature(n,t,i,r){if(this._filter&&this._filter(t,i)===!1)return null;const e=this.getStyle(t),f=this._getIDForLayerFeature(t)||r;let u=this._mVTFeatures[f];return u?(u.setStyle(e),u.addTileFeature(t,i)):(u=new MVTFeature({mVTSource:n,vectorTileFeature:t,tileContext:i,style:e,selected:n.isFeatureSelected(f),featureId:f,customDraw:this._customDraw}),this._mVTFeatures[f]=u),u}drawTile(n){const i=this._canvasAndMVTFeatures[n.id];if(i){const r=i.features,t=[];for(let i=0,u=r.length;i<u;i++){const u=r[i];u.selected?t.push(u):u.draw(n)}for(let i=0,r=t.length;i<r;i++)t[i].draw(n)}}getCanvas(n){const t=this._canvasAndMVTFeatures[n];return t?t.canvas:null}getStyle(n){return typeof this.style=="function"?this.style(n):this.style}setStyle(n){this.style=n;const t=this._mVTFeatures;for(const i in t)t[i].setStyle(n)}setSelected(n){const t=this._mVTFeatures[n];t!==undefined&&t.select()}setFilter(n){this._filter=n}handleClickEvent(n,t){const i=this._canvasAndMVTFeatures[n.tileContext.id];if(!i)return n;const r=i.features;return r?(n.feature=this._handleClickEvent(n,r,t),n):n}_handleClickEvent(n,t,i){const u=n.tileContext.id,f=i.getSelectedFeaturesInTile(u);let r=this._handleClickFeatures(n,f);return r?r:this._handleClickFeatures(n,t)}_handleClickFeatures(n,t){let r=null,i=Number.POSITIVE_INFINITY;for(let u=t.length-1;u>=0;u--){const f=this._handleClickFeature(n,t[u],i);if(f&&f.distance<i&&(r=f.feature,i=f.distance,i===0))return r}return r}_handleClickFeature(n,t,i){if(t.type===3)return t.isPointInPath(n.tilePoint,n.tileContext)?{feature:t,distance:0}:null;const f=t.getPaths(n.tileContext),r=n.tilePoint,e=t.type;let u=i,o=!1;for(let n=f.length-1;n>=0;n--){const i=f[n];if(e===1){if(MERCATOR.in_circle(i[0].x,i[0].y,t.style.radius,r.x,r.y))return{feature:t,distance:0}}else if(e===2){const n=MERCATOR.getDistanceFromLine(r,i),f=t.style,e=t.selected&&f.selected?f.selected.lineWidth:f.lineWidth;n<e/2+this._lineClickTolerance&&n<u&&(u=n,o=!0)}}return o?{feature:t,distance:u}:null}}class MVTSource{constructor(n,t){var i=this;this.map=n;this._url=t.url||"";this._sourceMaxZoom=t.sourceMaxZoom||!1;this._debug=t.debug||!1;this.getIDForLayerFeature=t.getIDForLayerFeature||function(n){return n.properties.id||n.properties.Id||n.properties.ID};this._visibleLayers=t.visibleLayers||!1;this._xhrHeaders=t.xhrHeaders||{};this._clickableLayers=t.clickableLayers||!1;this._filter=t.filter||!1;this._cache=t.cache||!1;this._tileSize=t.tileSize||256;this.tileSize=new google.maps.Size(this._tileSize,this._tileSize);this.style=t.style||function(n){var t={};switch(n.type){case 1:t.fillStyle="rgba(49,79,79,1)";t.radius=5;t.selected={fillStyle:"rgba(255,255,0,0.5)",radius:6};break;case 2:t.strokeStyle="rgba(136, 86, 167, 1)";t.lineWidth=3;t.selected={strokeStyle:"rgba(255,25,0,0.5)",lineWidth:4};break;case 3:t.fillStyle="rgba(188, 189, 220, 0.5)";t.strokeStyle="rgba(136, 86, 167, 1)";t.lineWidth=1;t.selected={fillStyle:"rgba(255,140,0,0.3)",strokeStyle:"rgba(255,140,0,1)",lineWidth:2}}return t};this._customDraw=t.customDraw||!1;this.mVTLayers=[];this._tilesDrawn=[];this._visibleTiles=[];this._selectedFeatures=[];t.selectedFeatures&&this.setSelectedFeatures(t.selectedFeatures);this.map.addListener("zoom_changed",()=>{i._zoomChanged()})}getTile(n,t,i){var r=this.drawTile(n,t,i);return this._setVisibleTile(r),r.canvas}releaseTile(){}_zoomChanged(){this._resetVisibleTiles();this._cache||this._resetMVTLayers()}_resetMVTLayers(){this.mVTLayers=[]}_deleteVisibleTile(n){delete this._visibleTiles[n]}_resetVisibleTiles(){this._visibleTiles=[]}_setVisibleTile(n){this._visibleTiles[n.id]=n}drawTile(n,t,i){var u=this.getTileId(t,n.x,n.y),r=this._tilesDrawn[u];return r?r:(r=this._createTileContext(n,t,i),this._xhrRequest(r),r)}_createTileContext(n,t,i){var r=this.getTileId(t,n.x,n.y),u=this._createCanvas(i,r),f=this._getParentId(r);return{id:r,canvas:u,zoom:t,tileSize:this._tileSize,parentId:f}}_getParentId(n){var r=!1,t;if(this._sourceMaxZoom&&(t=this.getTileObject(n),t.zoom>this._sourceMaxZoom)){var i=t.zoom-this._sourceMaxZoom,u=t.zoom-i,f=t.x>>i,e=t.y>>i;r=this.getTileId(u,f,e)}return r}_createCanvas(n,t){const i=n.createElement("canvas");return i.width=this._tileSize,i.height=this._tileSize,i.id=t,i}getTileId(n,t,i){return[n,t,i].join(":")}getTileObject(n){var t=n.split(":");return{zoom:parseInt(t[0]),x:t[1],y:t[2]}}_xhrRequest(n){var u=this,f=n.parentId||n.id,i=this.getTileObject(f),e=this._url.replace("{z}",i.zoom).replace("{x}",i.x).replace("{y}",i.y),t=new XMLHttpRequest,r;t.onload=function(){if(t.status=="200"&&t.response)return u._xhrResponseOk(n,t.response);u._drawDebugInfo(n)};t.open("GET",e,!0);for(r in this._xhrHeaders)t.setRequestHeader(r,this._xhrHeaders[r]);t.responseType="arraybuffer";t.send()}_xhrResponseOk(n,t){if(this.map.getZoom()==n.zoom){var i=new Uint8Array(t),r=new Pbf(i),u=new VectorTile(r);this._drawVectorTile(u,n)}}_setTileDrawn(n){this._cache&&(this._tilesDrawn[n.id]=n)}deleteTileDrawn(n){delete this._tilesDrawn[n]}_resetTileDrawn(){this._tilesDrawn=[]}_drawVectorTile(n,t){var r,f,i,u;if(this._visibleLayers)for(r=0,f=this._visibleLayers.length;r<f;r++)i=this._visibleLayers[r],n.layers[i]&&(u=n.layers[i],this._drawVectorTileLayer(u,i,t));else for(i in n.layers)u=n.layers[i],this._drawVectorTileLayer(u,i,t);t.vectorTile=n;this._drawDebugInfo(t);this._setTileDrawn(t)}_drawVectorTileLayer(n,t,i){this.mVTLayers[t]||(this.mVTLayers[t]=this._createMVTLayer(t));var r=this.mVTLayers[t];r.parseVectorTileFeatures(this,n.parsedFeatures,i)}_createMVTLayer(n){var t={getIDForLayerFeature:this.getIDForLayerFeature,filter:this._filter,style:this.style,name:n,customDraw:this._customDraw};return new MVTLayer(t)}_drawDebugInfo(n){if(this._debug){var u=this.getTileObject(n.id),i=this._tileSize,r=this._tileSize,t=n.canvas.getContext("2d");t.strokeStyle="#000000";t.fillStyle="#FFFF00";t.strokeRect(0,0,i,r);t.font="12px Arial";t.fillRect(0,0,5,5);t.fillRect(0,r-5,5,5);t.fillRect(i-5,0,5,5);t.fillRect(i-5,r-5,5,5);t.fillRect(i/2-5,r/2-5,10,10);t.strokeText(n.zoom+" "+u.x+" "+u.y,i/2-30,r/2-10)}}onClick(n,t,i){this._multipleSelection=i&&i.multipleSelection||!1;i=this._getMouseOptions(i,!1);this._mouseEvent(n,t,i)}onMouseHover(n,t,i){this._multipleSelection=!1;i=this._getMouseOptions(i,!0);this._mouseEvent(n,t,i)}_getMouseOptions(n,t){return{mouseHover:t,setSelected:n.setSelected||!1,toggleSelection:n.toggleSelection===undefined||n.toggleSelection,limitToFirstVisibleLayer:n.limitToFirstVisibleLayer||!1,delay:n.delay||0}}_mouseEvent(n,t,i){if(n.pixel&&n.latLng){if(i.delay==0)return this._mouseEventContinue(n,t,i);this.event=n;var r=this;setTimeout(function(){n==r.event&&r._mouseEventContinue(r.event,t,i)},i.delay,n)}}_mouseEventContinue(n,t,i){var f,r,s,e,n;t=t||function(){};var h=i.limitToFirstVisibleLayer||!1,c=this.map.getZoom(),u=MERCATOR.getTileAtLatLng(n.latLng,c),l=this.getTileId(u.z,u.x,u.y),o=this._visibleTiles[l];if(o)for(n.tileContext=o,n.tilePoint=MERCATOR.fromLatLngToTilePoint(this.map,n),f=this._clickableLayers||Object.keys(this.mVTLayers)||[],r=f.length-1;r>=0;r--)if(s=f[r],e=this.mVTLayers[s],e&&(n=e.handleClickEvent(n,this),this._mouseSelectedFeature(n,t,i),h&&n.feature))break}_mouseSelectedFeature(n,t,i){if(i.setSelected){var r=n.feature;r?i.mouseHover?r.selected||r.select():i.toggleSelection?r.toggle():r.selected||r.select():i.mouseHover&&this.deselectAllFeatures()}t(n)}deselectAllFeatures(){var e=this.map.getZoom(),i=[],r,n,u,t,f;for(r in this._selectedFeatures)if(n=this._selectedFeatures[r],n){n.setSelected(!1);u=n.getTiles();for(t in u)this.deleteTileDrawn(t),f=this.getTileObject(t),f.zoom==e&&(i[t]=!0)}this.redrawTiles(i);this._selectedFeatures=[]}featureSelected(n){this._multipleSelection||this.deselectAllFeatures();this._selectedFeatures[n.featureId]=n}featureDeselected(n){delete this._selectedFeatures[n.featureId]}setSelectedFeatures(n){var t,r,i,u;for(n.length>1&&(this._multipleSelection=!0),this.deselectAllFeatures(),t=0,r=n.length;t<r;t++){i=n[t];this._selectedFeatures[i]=!1;for(u in this.mVTLayers)this.mVTLayers[u].setSelected(i)}}isFeatureSelected(n){return this._selectedFeatures[n]!=undefined}getSelectedFeatures(){var n=[];for(var t in this._selectedFeatures)n.push(this._selectedFeatures[t]);return n}getSelectedFeaturesInTile(n){var i=[],r,t,u;for(r in this._selectedFeatures){t=this._selectedFeatures[r];for(u in t.tiles)u==n&&i.push(t)}return i}setFilter(n,t){t=t===undefined||t;this._filter=n;for(var i in this.mVTLayers)this.mVTLayers[i].setFilter(n);t&&this.redrawAllTiles()}setStyle(n,t){t=t===undefined||t;this.style=n;for(var i in this.mVTLayers)this.mVTLayers[i].setStyle(n);t&&this.redrawAllTiles()}setVisibleLayers(n,t){t=t===undefined||t;this._visibleLayers=n;t&&this.redrawAllTiles()}getVisibleLayers(){return this._visibleLayers}setClickableLayers(n){this._clickableLayers=n}redrawAllTiles(){this._resetTileDrawn();this.redrawTiles(this._visibleTiles)}redrawTiles(n){for(var t in n)this.redrawTile(t)}redrawTile(n){this.deleteTileDrawn(n);var t=this._visibleTiles[n];t&&t.vectorTile&&(this.clearTile(t.canvas),this._drawVectorTile(t.vectorTile,t))}clearTile(n){var t=n.getContext("2d");t.clearRect(0,0,n.width,n.height)}setUrl(n,t){t=t===undefined||t;this._url=n;this._resetMVTLayers();t&&this.redrawAllTiles()}}